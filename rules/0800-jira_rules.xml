<!-- 
Jira Audit Rules for Wazuh
Filename: 0580-jira_audit_rules.xml
Location: /var/ossec/etc/rules/
IDs: 100800 - 100999
-->

<group name="jira,audit,atlassian,">

  <!-- ========================================== -->
  <!-- BASE RULE -->
  <!-- ========================================== -->
  
  <rule id="100800" level="3">
    <decoded_as>json</decoded_as>
    <field name="jira.summary">\.+</field>
    <description>Jira: $(jira.summary) by $(actor)</description>
    <group>jira_audit,</group>
  </rule>

  <!-- ========================================== -->
  <!-- SCRIPT STATUS -->
  <!-- ========================================== -->
  
  <rule id="100801" level="3">
    <decoded_as>json</decoded_as>
    <field name="jira.action">\.+</field>
    <description>Jira Script: $(jira.description)</description>
    <group>jira_script,</group>
  </rule>

  <rule id="100802" level="14">
    <if_sid>100801</if_sid>
    <field name="jira.action">extraction error</field>
    <description>Jira: Extraction error</description>
    <group>jira_error,</group>
  </rule>

  <!-- ========================================== -->
  <!-- USER MANAGEMENT -->
  <!-- ========================================== -->
  
  <rule id="100810" level="9">
    <if_sid>100800</if_sid>
    <field name="jira.category">user management</field>
    <field name="jira.summary">User created</field>
    <description>Jira User Created: $(user) by $(actor) from $(srcip)</description>
    <mitre>
      <id>T1136</id>
    </mitre>
    <group>jira_user_mgmt,user_creation,pci_dss_10.2.5,</group>
  </rule>

  <rule id="100811" level="10">
    <if_sid>100800</if_sid>
    <field name="jira.category">user management</field>
    <field name="jira.summary">User deleted</field>
    <description>Jira User Deleted: $(user) by $(actor)</description>
    <group>jira_user_mgmt,user_deletion,</group>
  </rule>

  <rule id="100812" level="9">
    <if_sid>100800</if_sid>
    <field name="jira.category">user management</field>
    <field name="jira.summary">User deactivated</field>
    <description>Jira User Deactivated: $(user) by $(actor)</description>
    <group>jira_user_mgmt,user_deactivation,</group>
  </rule>

  <rule id="100813" level="8">
    <if_sid>100800</if_sid>
    <field name="jira.category">user management</field>
    <field name="jira.summary">User updated</field>
    <description>Jira User Updated: $(user) by $(actor)</description>
    <group>jira_user_mgmt,user_update,</group>
  </rule>

  <rule id="100814" level="7">
    <if_sid>100800</if_sid>
    <field name="jira.category">user management</field>
    <field name="jira.summary">password changed</field>
    <description>Jira Password Changed: $(user) from $(srcip)</description>
    <group>jira_user_mgmt,password_change,pci_dss_10.2.5,</group>
  </rule>

  <!-- ========================================== -->
  <!-- GROUP MANAGEMENT -->
  <!-- ========================================== -->
  
  <rule id="100820" level="8">
    <if_sid>100800</if_sid>
    <field name="jira.category">group management</field>
    <field name="jira.summary">User added to group</field>
    <description>Jira: User added to group by $(actor)</description>
    <mitre>
      <id>T1098</id>
    </mitre>
    <group>jira_group_mgmt,group_addition,pci_dss_10.2.5,</group>
  </rule>

  <rule id="100821" level="11">
    <if_sid>100820</if_sid>
    <field name="jira.objectItem.name">admin</field>
    <description>Jira ADMIN ACCESS: User added to admin group by $(actor)</description>
    <group>jira_admin_group,privilege_escalation,gdpr_IV_35.7.d,</group>
  </rule>

  <rule id="100822" level="8">
    <if_sid>100800</if_sid>
    <field name="jira.category">group management</field>
    <field name="jira.summary">User removed from group</field>
    <description>Jira: User removed from group by $(actor)</description>
    <group>jira_group_mgmt,group_removal,</group>
  </rule>

  <rule id="100823" level="9">
    <if_sid>100800</if_sid>
    <field name="jira.category">group management</field>
    <field name="jira.summary">Group created</field>
    <description>Jira Group Created by $(actor)</description>
    <group>jira_group_mgmt,group_creation,</group>
  </rule>

  <rule id="100824" level="10">
    <if_sid>100800</if_sid>
    <field name="jira.category">group management</field>
    <field name="jira.summary">Group deleted</field>
    <description>Jira Group Deleted by $(actor)</description>
    <group>jira_group_mgmt,group_deletion,</group>
  </rule>

  <!-- ========================================== -->
  <!-- PROJECTS -->
  <!-- ========================================== -->
  
  <rule id="100830" level="4">
    <if_sid>100800</if_sid>
    <field name="jira.category">projects</field>
    <field name="jira.summary">Project version created</field>
    <description>Jira: Project version created by $(actor)</description>
    <group>jira_projects,version_creation,</group>
  </rule>

  <rule id="100831" level="4">
    <if_sid>100800</if_sid>
    <field name="jira.category">projects</field>
    <field name="jira.summary">Project version released</field>
    <description>Jira: Project version released by $(actor)</description>
    <group>jira_projects,version_release,</group>
  </rule>

  <rule id="100832" level="5">
    <if_sid>100800</if_sid>
    <field name="jira.category">projects</field>
    <field name="jira.summary">Project version archived</field>
    <description>Jira: Project version archived by $(actor)</description>
    <group>jira_projects,version_archive,</group>
  </rule>

  <rule id="100833" level="6">
    <if_sid>100800</if_sid>
    <field name="jira.category">projects</field>
    <field name="jira.summary">Project deleted</field>
    <description>Jira: Project DELETED by $(actor)</description>
    <mitre>
      <id>T1485</id>
    </mitre>
    <group>jira_projects,project_deletion,data_loss,pci_dss_10.2.7,</group>
  </rule>

  <!-- ========================================== -->
  <!-- SPRINTS -->
  <!-- ========================================== -->
  
  <rule id="100840" level="5">
    <if_sid>100800</if_sid>
    <field name="jira.category">sprints</field>
    <field name="jira.summary">Sprint started</field>
    <description>Jira Sprint Started by $(actor)</description>
    <group>jira_sprints,sprint_start,</group>
  </rule>

  <rule id="100841" level="5">
    <if_sid>100800</if_sid>
    <field name="jira.category">sprints</field>
    <field name="jira.summary">Sprint closed</field>
    <description>Jira Sprint Closed by $(actor)</description>
    <group>jira_sprints,sprint_close,</group>
  </rule>

  <rule id="100842" level="10">
    <if_sid>100800</if_sid>
    <field name="jira.category">sprints</field>
    <field name="jira.summary">Sprint deleted</field>
    <description>Jira Sprint DELETED by $(actor)</description>
    <mitre>
      <id>T1485</id>
    </mitre>
    <group>jira_sprints,sprint_deletion,data_loss,pci_dss_10.2.7,</group>
  </rule>

  <!-- ========================================== -->
  <!-- WORKFLOWS -->
  <!-- ========================================== -->
  
  <rule id="100850" level="6">
    <if_sid>100800</if_sid>
    <field name="jira.category">workflows</field>
    <description>Jira Workflow: $(jira.summary) by $(actor)</description>
    <group>jira_workflows,</group>
  </rule>

  <!-- ========================================== -->
  <!-- FIELDS -->
  <!-- ========================================== -->
  
  <rule id="100860" level="3">
    <if_sid>100800</if_sid>
    <field name="jira.category">fields</field>
    <description>Jira Field: $(jira.summary)</description>
    <group>jira_fields,</group>
  </rule>

  <!-- ========================================== -->
  <!-- SCREENS -->
  <!-- ========================================== -->
  
  <rule id="100870" level="4">
    <if_sid>100800</if_sid>
    <field name="jira.category">screens</field>
    <description>Jira Screen: $(jira.summary)</description>
    <group>jira_screens,</group>
  </rule>

  <!-- ========================================== -->
  <!-- FREQUENCY RULES -->
  <!-- ========================================== -->
  
  <rule id="100900" level="11" frequency="10" timeframe="300">
    <if_matched_sid>100810</if_matched_sid>
    <description>Jira: 10+ user creations in 5min</description>
    <mitre>
      <id>T1136</id>
    </mitre>
    <group>jira_multiple_users,suspicious_activity,</group>
  </rule>

  <rule id="100901" level="12" frequency="3" timeframe="300">
    <if_matched_sid>100842</if_matched_sid>
    <description>Jira: 3+ sprint deletions in 5min</description>
    <mitre>
      <id>T1485</id>
    </mitre>
    <group>jira_multiple_deletions,data_loss,critical,</group>
  </rule>

  <rule id="100902" level="11" frequency="15" timeframe="300">
    <if_matched_sid>100820</if_matched_sid>
    <same_field>actor</same_field>
    <description>Jira: 15+ group additions by $(actor) in 5min</description>
    <group>jira_bulk_group_changes,suspicious_activity,</group>
  </rule>

  <!-- ========================================== -->
  <!-- OFF-HOURS DETECTION -->
  <!-- ========================================== -->
  
  <rule id="100910" level="10">
    <if_sid>100821</if_sid>
    <time>22:00-06:00</time>
    <description>Jira ADMIN ACCESS OFF-HOURS by $(actor)</description>
    <mitre>
      <id>T1098</id>
    </mitre>
    <group>jira_off_hours,admin_access,suspicious_activity,</group>
  </rule>

  <rule id="100911" level="9">
    <if_sid>100810</if_sid>
    <time>22:00-06:00</time>
    <description>Jira User Created OFF-HOURS by $(actor) from $(srcip)</description>
    <mitre>
      <id>T1136</id>
    </mitre>
    <group>jira_off_hours,user_creation,suspicious_activity,</group>
  </rule>

</group>